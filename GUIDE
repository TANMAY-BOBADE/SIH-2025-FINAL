# üåæ Complete ESP32 Setup Guide - Kissan Agriculture Project

## üìã Table of Contents
1. [Arduino IDE Setup](#arduino-ide-setup)
2. [Library Installation](#library-installation)
3. [Hardware Connections](#hardware-connections)
4. [Code Configuration](#code-configuration)
5. [Upload Procedure](#upload-procedure)
6. [Testing Guide](#testing-guide)
7. [Troubleshooting](#troubleshooting)

---

## 1Ô∏è‚É£ ARDUINO IDE SETUP

### Step 1.1: Install Arduino IDE
1. Download from: https://www.arduino.cc/en/software
2. Install version 2.0+ (recommended)

### Step 1.2: Add ESP32 Board Support
1. Open Arduino IDE
2. Go to **File ‚Üí Preferences**
3. In "Additional Board Manager URLs", add:
   ```
   https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
   ```
4. Click OK
5. Go to **Tools ‚Üí Board ‚Üí Boards Manager**
6. Search "ESP32"
7. Install **"esp32 by Espressif Systems"** (version 2.0.14 or later)

### Step 1.3: Add ESP8266 Board Support
1. In Preferences, add to URLs (separate with comma):
   ```
   http://arduino.esp8266.com/stable/package_esp8266com_index.json
   ```
2. Go to Boards Manager
3. Search "ESP8266"
4. Install **"esp8266 by ESP8266 Community"**

---

## 2Ô∏è‚É£ LIBRARY INSTALLATION

### Method 1: Using Library Manager (Recommended)
Go to **Sketch ‚Üí Include Library ‚Üí Manage Libraries**, search and install:

#### For All ESP32 Boards:
- ‚úÖ **DHT sensor library** by Adafruit (version 1.4.4+)
- ‚úÖ **Adafruit Unified Sensor** (dependency)
- ‚úÖ **Firebase ESP32 Client** by Mobizt (version 4.4.14+)
- ‚úÖ **ArduinoJson** by Benoit Blanchon (version 6.21+)
- ‚úÖ **LoRa** by Sandeep Mistry (version 0.8.0+)
- ‚úÖ **ESP32Servo** by Kevin Harrington (version 3.0.5+)

#### For ESP8266:
- ‚úÖ **ESP8266WiFi** (included)
- ‚úÖ **ESP8266WebServer** (included)

### Method 2: Manual Installation (if needed)
1. Download library ZIP from GitHub
2. **Sketch ‚Üí Include Library ‚Üí Add .ZIP Library**
3. Select downloaded file

---

## 3Ô∏è‚É£ HARDWARE CONNECTIONS

### 3.1 DRIP IRRIGATION ESP32

#### Pin Connections:
```
DHT11 Sensor:
  VCC  ‚Üí  ESP32 3.3V
  GND  ‚Üí  ESP32 GND
  DATA ‚Üí  GPIO 4

Soil Moisture Sensor (Capacitive):
  VCC  ‚Üí  ESP32 3.3V
  GND  ‚Üí  ESP32 GND
  AOUT ‚Üí  GPIO 34

Relay Module (Valve):
  VCC  ‚Üí  ESP32 5V
  GND  ‚Üí  ESP32 GND
  IN   ‚Üí  GPIO 25

GSM Module (SIM800L):
  VCC  ‚Üí  External 5V (needs min 2A supply!)
  GND  ‚Üí  Common ground with ESP32
  TX   ‚Üí  GPIO 16 (ESP32 RX)
  RX   ‚Üí  GPIO 17 (ESP32 TX)

LoRa Module (SX1278):
  VCC  ‚Üí  ESP32 3.3V
  GND  ‚Üí  ESP32 GND
  SCK  ‚Üí  GPIO 5
  MISO ‚Üí  GPIO 19
  MOSI ‚Üí  GPIO 27
  NSS  ‚Üí  GPIO 18
  RST  ‚Üí  GPIO 14
  DIO0 ‚Üí  GPIO 26
```

**‚ö†Ô∏è CRITICAL: GSM Module Power**
- SIM800L needs **4.0V and 2A** during transmission
- Use a separate 5V/2A power supply
- Connect grounds together (common ground)

---

### 3.2 ROVER MAIN ESP32

#### Pin Connections:
```
DHT11 Sensor:
  (Same as irrigation node)

Soil Moisture Sensor:
  (Same as irrigation node)

Disc Servo (360¬∞ Continuous):
  VCC    ‚Üí  ESP32 5V (external supply recommended)
  GND    ‚Üí  ESP32 GND
  SIGNAL ‚Üí  GPIO 13

Flap Servo (Standard):
  VCC    ‚Üí  ESP32 5V
  GND    ‚Üí  ESP32 GND
  SIGNAL ‚Üí  GPIO 15

L298N Motor Driver (Rack & Pinion):
  12V    ‚Üí  External 12V battery
  GND    ‚Üí  Common ground
  5V     ‚Üí  ESP32 VIN (or separate 5V)
  ENA    ‚Üí  GPIO 25
  IN1    ‚Üí  GPIO 26
  IN2    ‚Üí  GPIO 27
  IN3    ‚Üí  GPIO 14
  IN4    ‚Üí  GPIO 12
  ENB    ‚Üí  GPIO 33
  OUT1/2 ‚Üí  Motor A
  OUT3/4 ‚Üí  Motor B

Pump Relay:
  VCC  ‚Üí  ESP32 5V
  GND  ‚Üí  ESP32 GND
  IN   ‚Üí  GPIO 32
```

**‚ö†Ô∏è Power Requirements:**
- Rover needs **12V battery** for motors
- Use **7805 voltage regulator** or **buck converter** to get 5V for ESP32
- Servos need stable 5V (use separate regulator if needed)

---

### 3.3 ROVER MOVEMENT ESP8266

#### Pin Connections:
```
L298N Motor Driver (Wheels):
  12V    ‚Üí  External 12V battery
  GND    ‚Üí  Common ground
  5V     ‚Üí  ESP8266 VIN
  ENA    ‚Üí  D0
  IN1    ‚Üí  D1
  IN2    ‚Üí  D2
  IN3    ‚Üí  D3
  IN4    ‚Üí  D4
  ENB    ‚Üí  D5
  OUT1/2 ‚Üí  Left Motor
  OUT3/4 ‚Üí  Right Motor
```

---

### 3.4 TANK MONITOR ESP32

#### Pin Connections:
```
Ultrasonic Sensor (HC-SR04):
  VCC  ‚Üí  ESP32 5V
  GND  ‚Üí  ESP32 GND
  TRIG ‚Üí  GPIO 12
  ECHO ‚Üí  GPIO 13

LoRa Module:
  (Same pin configuration as irrigation node)

Power:
  ESP32 powered by solar panel + battery (optional)
  Use TP4056 charging module for Li-ion battery
```

---

## 4Ô∏è‚É£ CODE CONFIGURATION

### 4.1 Drip Irrigation ESP32

Open the code and update these lines:

```cpp
// Line 22: Database Secret
#define DATABASE_SECRET "AIza...your_actual_secret_from_firebase"

// Line 28: GSM APN (Change based on your SIM)
// Airtel: airtelgprs.com
// Jio: jionet
// Vodafone: www
// BSNL: bsnlnet
#define GSM_APN "airtelgprs.com"

// Line 32: OpenWeather API Key (your key from openweathermap.org)
#define WEATHER_API_KEY "your_openweather_api_key"

// Line 403: SMS Phone Number (for alerts)
sendSMS("+919876543210", "Tank water level low!");
```

**Getting Database Secret:**
1. Firebase Console ‚Üí Project Settings
2. Service accounts tab
3. Database secrets ‚Üí Show/Add secret
4. Copy the secret key

**Getting OpenWeather API Key:**
1. Go to https://openweathermap.org/api
2. Sign up (free)
3. API keys tab ‚Üí Copy key

---

### 4.2 Rover Main ESP32

Update these lines:

```cpp
// Line 13: Database Secret
#define DATABASE_SECRET "your_firebase_database_secret"

// Line 7-8: WiFi Hotspot (optional - change if needed)
const char* ssid = "AgriRover";
const char* password = "rover123";
```

---

### 4.3 Rover Movement ESP8266

Update WiFi credentials:

```cpp
// Lines 6-7
const char* ssid = "AgriRover";      // Must match Rover ESP32 hotspot
const char* password = "rover123";
```

---

### 4.4 Tank Monitor ESP32

Adjust tank specifications:

```cpp
// Line 17: Your tank's total height in cm
#define TANK_HEIGHT_CM 200.0

// Line 18: Distance from sensor mounting to full water level
#define SENSOR_OFFSET_CM 5.0
```

**How to measure:**
1. Measure tank height from bottom to top
2. Measure distance from sensor location to full water surface
3. Update these values

---

## 5Ô∏è‚É£ UPLOAD PROCEDURE

### 5.1 Drip Irrigation ESP32

1. Connect ESP32 to computer via USB
2. **Tools ‚Üí Board ‚Üí ESP32 Dev Module**
3. **Tools ‚Üí Port ‚Üí Select COM port**
4. **Tools ‚Üí Upload Speed ‚Üí 115200**
5. Click **Upload** button
6. Wait for "Done uploading"
7. Open **Serial Monitor** (115200 baud)
8. Press ESP32 **RST button**
9. Verify output shows:
   ```
   ===== DRIP IRRIGATION NODE STARTING =====
   ‚úì LoRa initialized
   Connecting to GSM...
   ‚úì GSM Connected!
   ‚úì Firebase connected!
   ===== SYSTEM READY =====
   ```

**Troubleshooting Upload:**
- If upload fails, hold **BOOT button** while clicking upload
- Release BOOT when "Connecting..." appears

---

### 5.2 Rover Main ESP32

1. Same upload procedure as above
2. Select **ESP32 Dev Module**
3. Verify Serial Monitor shows:
   ```
   ===== ROVER MAIN CONTROLLER STARTING =====
   ‚úì WiFi Hotspot Created
   SSID: AgriRover
   IP Address: 192.168.4.1
   ‚úì Web server started
   ===== SYSTEM READY =====
   ```

---

### 5.3 Rover Movement ESP8266

1. **Tools ‚Üí Board ‚Üí NodeMCU 1.0 (ESP-12E Module)**
2. **Tools ‚Üí Port ‚Üí Select COM port**
3. **Tools ‚Üí Upload Speed ‚Üí 115200**
4. Upload code
5. Verify Serial Monitor (9600 baud) shows:
   ```
   ===== ROVER MOVEMENT CONTROLLER =====
   Connecting to Rover WiFi.....
   ‚úì Connected to Rover!
   IP Address: 192.168.4.2
   ===== SYSTEM READY =====
   ```

---

### 5.4 Tank Monitor ESP32

1. Upload using same procedure as Drip Irrigation
2. Verify Serial Monitor shows:
   ```
   ===== TANK LEVEL MONITOR =====
   ‚úì LoRa initialized
   Frequency: 433 MHz
   ===== SYSTEM READY =====
   Distance: 45.2 cm | Water Level: 75.5%
   ‚úì Transmitted: TANK:75.5
   ```

---

## 6Ô∏è‚É£ TESTING GUIDE

### 6.1 Test Drip Irrigation Node

**Step 1: Test Sensors**
```
Watch Serial Monitor:
T: 25.3¬∞C | H: 65.2% | M: 45.8%
‚úì Data uploaded to Firebase
```

**Step 2: Test Valve Control**
- Go to Firebase Console ‚Üí Realtime Database
- Set `/irrigation/valve/command` to `"OPEN"`
- Relay should click and valve opens
- Serial shows: `‚úì VALVE OPENED`

**Step 3: Test Crop Intelligence**
- Set `/irrigation/crop_intelligence/status` to `"ON"`
- System auto-controls based on thresholds

**Step 4: Test LoRa Reception**
- Turn on Tank Monitor
- Serial shows: `LoRa: Tank level received: 75.5%`

---

### 6.2 Test Rover System

**Step 1: Connect to Rover**
- Open phone WiFi settings
- Connect to "AgriRover" network
- Password: rover123

**Step 2: Test Movement**
- Open browser: `http://192.168.4.1/rover/move/forward`
- Rover should move forward
- Try: `/backward`, `/left`, `/right`, `/stop`

**Step 3: Test Plantation Sequence**
- Open: `http://192.168.4.1/rover/plant/start`
- Watch Serial Monitor for step-by-step execution
- Verify:
  - Rack moves down
  - Disc rotates 60¬∞
  - Flap opens/closes
  - Rack moves up

**Step 4: Test Dashboard**
- Open your deployed dashboard
- Click "Rover Control"
- Select crop and stage
- Use arrow buttons for movement
- Click "START PLANTING"

---

## 7Ô∏è‚É£ TROUBLESHOOTING

### Issue: ESP32 won't upload code
**Solution:**
- Hold BOOT button during upload
- Check USB cable (needs data lines, not just power)
- Try different COM port
- Reduce upload speed to 921600 or 460800

### Issue: GSM module not connecting
**Solution:**
- Check power supply (needs 2A minimum)
- Verify SIM card has active data plan
- Check APN settings for your carrier
- Move to location with good signal
- Wait 30 seconds for network registration

### Issue: Firebase connection fails
**Solution:**
- Verify DATABASE_URL is correct
- Check DATABASE_SECRET is valid
- Ensure GSM has internet (ping test)
- Check Firebase rules allow writes

### Issue: LoRa not receiving
**Solution:**
- Both modules must use same frequency (433 MHz)
- Check antenna connections
- Verify pin connections
- Test range (start close, then increase distance)

### Issue: Sensors reading wrong values
**Solution:**
- **DHT11:** Add 10kŒ© pullup resistor on data line
- **Soil Moisture:** Calibrate by testing in dry/wet soil
- **Ultrasonic:** Check if echo pin has clean signal

### Issue: Motors not moving
**Solution:**
- Check 12V battery charge
- Verify motor driver connections
- Test motors directly with battery
- Check if EN pins have PWM signal

### Issue: Servos jittering
**Solution:**
- Use separate 5V power supply (not ESP32 pin)
- Add 1000¬µF capacitor across servo power
- Ensure common ground connection

---

## üìû ADDITIONAL RESOURCES

**Firebase Documentation:**
https://firebase.google.com/docs/database

**ESP32 Pinout Reference:**
https://randomnerdtutorials.com/esp32-pinout-reference-gpios/

**LoRa Tutorial:**
https://randomnerdtutorials.com/esp32-lora-rfm95-transceiver-arduino-ide/

**GSM AT Commands:**
https://www.tutorialspoint.com/gsm/gsm_at_commands.htm

---

## ‚úÖ PRE-DEPLOYMENT CHECKLIST

Before taking to field:

### Hardware:
- [ ] All connections soldered (no loose wires)
- [ ] Power supplies rated correctly
- [ ] Waterproof enclosures for outdoor nodes
- [ ] Antennas properly attached
- [ ] Sensors calibrated

### Software:
- [ ] Firebase credentials updated
- [ ] GSM APN configured
- [ ] Phone numbers for SMS updated
- [ ] Crop thresholds verified in database
- [ ] All codes uploaded successfully

### Testing:
- [ ] Sensors reading accurately
- [ ] Motors/servos moving smoothly
- [ ] Firebase sync working
- [ ] LoRa communication confirmed
- [ ] Weather API responding
- [ ] Dashboard controls working

### Field Setup:
- [ ] Solar panels positioned (if used)
- [ ] GSM antenna has clear sky view
- [ ] Tank sensor mounted correctly
- [ ] Rover battery fully charged
- [ ] Backup SIM card available

---

## üéâ YOU'RE READY!

Your complete agriculture automation system is now configured and ready for deployment!

**Next Steps:**
1. Field test for 24 hours
2. Monitor logs for any errors
3. Fine-tune sensor thresholds
4. Train farmers on dashboard usage
5. Set up routine maintenance schedule

Good luck with your SIH project! üåæüöú
